{"version":3,"sources":["../../src/serializer/types.js"],"names":["AreSameSerializedBindings","realm","x","y","serializedValue","value","BodyReference","body","index","other","TimingStatistics","totalTime","globalCodeTime","initializeMoreModulesTime","deepTraversalTime","referenceCountsTime","serializePassTime","SerializerStatistics","objects","objectProperties","functions","functionClones","referentialized","valueIds","valuesInlined","delayedValues","console","log"],"mappings":";;;;;;;qjBAAA;;;;;;;;;QA6DgBA,yB,GAAAA,yB;;AAlDhB;;AACA;;AAGA;;AACA;;AACA;;;;;;;;AA4CO,SAASA,yBAAT,CAAmCC,KAAnC,EAAiDC,CAAjD,EAAuEC,CAAvE,EAA6F;AAClG,MAAID,EAAEE,eAAF,KAAsBD,EAAEC,eAA5B,EAA6C,OAAO,IAAP;AAC7C,MAAIF,EAAEG,KAAF,IAAWH,EAAEG,KAAF,KAAYF,EAAEE,KAA7B,EAAoC,OAAO,IAAP;AACpC,MAAIH,EAAEG,KAAF,oCAAoCF,EAAEE,KAAF,gCAAxC,EAA0E;AACxE,WAAO,yBAAUJ,KAAV,EAAiBC,EAAEG,KAAnB,EAA0BF,EAAEE,KAA5B,CAAP;AACD;AACD,SAAO,KAAP;AACD;;IAEYC,a,WAAAA,a;AACX,yBAAYC,IAAZ,EAA6CC,KAA7C,EAA4D;AAAA;;AAC1D,6BAAUA,SAAS,CAAnB;AACA,SAAKD,IAAL,GAAYA,IAAZ;AACA,SAAKC,KAAL,GAAaA,KAAb;AACD;;;;qCACgBC,K,EAA+B;AAC9C,aAAO,KAAKF,IAAL,KAAcE,MAAMF,IAApB,IAA4B,KAAKC,KAAL,IAAcC,MAAMD,KAAvD;AACD;;;;;;IAKUE,gB,WAAAA,gB,GACX,4BAAc;AAAA;;AACZ,OAAKC,SAAL,GAAiB,CAAjB;AACA,OAAKC,cAAL,GAAsB,CAAtB;AACA,OAAKC,yBAAL,GAAiC,CAAjC;AACA,OAAKC,iBAAL,GAAyB,CAAzB;AACA,OAAKC,mBAAL,GAA2B,CAA3B;AACA,OAAKC,iBAAL,GAAyB,CAAzB;AACD,C;;IASUC,oB,WAAAA,oB;AACX,kCAAc;AAAA;;AACZ,SAAKC,OAAL,GAAe,CAAf;AACA,SAAKC,gBAAL,GAAwB,CAAxB;AACA,SAAKC,SAAL,GAAiB,CAAjB;AACA,SAAKC,cAAL,GAAsB,CAAtB;AACA,SAAKC,eAAL,GAAuB,CAAvB;AACA,SAAKC,QAAL,GAAgB,CAAhB;AACA,SAAKC,aAAL,GAAqB,CAArB;AACA,SAAKC,aAAL,GAAqB,CAArB;AACD;;;;0BAUK;AACJC,cAAQC,GAAR;AACAD,cAAQC,GAAR,CAAe,KAAKT,OAApB,sBAA4C,KAAKC,gBAAjD;AACAO,cAAQC,GAAR,CACK,KAAKP,SADV,wBACsC,KAAKC,cAD3C,2CAC+F,KAC1FC,eAFL;AAIAI,cAAQC,GAAR,CACK,KAAKJ,QADV,mBACgC,KAAKE,aADrC,0CACuF,KAClFD,aAFL;AAID","file":"types.js","sourcesContent":["/**\n * Copyright (c) 2017-present, Facebook, Inc.\n * All rights reserved.\n *\n * This source code is licensed under the BSD-style license found in the\n * LICENSE file in the root directory of this source tree. An additional grant\n * of patent rights can be found in the PATENTS file in the same directory.\n */\n\n/* @flow */\n\nimport { DeclarativeEnvironmentRecord } from \"../environment.js\";\nimport { ConcreteValue, Value } from \"../values/index.js\";\nimport type { ECMAScriptSourceFunctionValue } from \"../values/index.js\";\nimport type { BabelNodeExpression, BabelNodeStatement } from \"babel-types\";\nimport { SameValue } from \"../methods/abstract.js\";\nimport { Realm } from \"../realm.js\";\nimport invariant from \"../invariant.js\";\n\nexport type TryQuery<T> = (f: () => T, defaultValue: T, logFailures: boolean) => T;\n\nexport type FunctionInstance = {\n  serializedBindings: SerializedBindings,\n  functionValue: ECMAScriptSourceFunctionValue,\n  insertionPoint?: BodyReference,\n  scopeInstances: Set<ScopeBinding>,\n};\n\nexport type Names = { [key: string]: true };\nexport type FunctionInfo = {\n  unbound: Names,\n  modified: Names,\n  usesArguments: boolean,\n  usesThis: boolean,\n};\n\nexport type SerializedBindings = { [key: string]: SerializedBinding };\nexport type SerializedBinding = {\n  value: void | Value,\n  // The serializedValue is only not yet present during the initialization of a binding that involves recursive dependencies.\n  serializedValue: void | BabelNodeExpression,\n  referentialized: boolean,\n  modified: boolean,\n  declarativeEnvironmentRecord?: DeclarativeEnvironmentRecord,\n  scope?: ScopeBinding,\n};\n\nexport type VisitedBindings = { [key: string]: VisitedBinding };\nexport type VisitedBinding = {\n  value: void | Value,\n  modified: boolean,\n  declarativeEnvironmentRecord?: DeclarativeEnvironmentRecord,\n};\n\nexport type ScopeBinding = {\n  name: string,\n  id: number,\n  initializationValues: Map<string, BabelNodeExpression>,\n  capturedScope?: string,\n};\n\nexport function AreSameSerializedBindings(realm: Realm, x: SerializedBinding, y: SerializedBinding) {\n  if (x.serializedValue === y.serializedValue) return true;\n  if (x.value && x.value === y.value) return true;\n  if (x.value instanceof ConcreteValue && y.value instanceof ConcreteValue) {\n    return SameValue(realm, x.value, y.value);\n  }\n  return false;\n}\n\nexport class BodyReference {\n  constructor(body: Array<BabelNodeStatement>, index: number) {\n    invariant(index >= 0);\n    this.body = body;\n    this.index = index;\n  }\n  isNotEarlierThan(other: BodyReference): boolean {\n    return this.body === other.body && this.index >= other.index;\n  }\n  body: Array<BabelNodeStatement>;\n  index: number;\n}\n\nexport class TimingStatistics {\n  constructor() {\n    this.totalTime = 0;\n    this.globalCodeTime = 0;\n    this.initializeMoreModulesTime = 0;\n    this.deepTraversalTime = 0;\n    this.referenceCountsTime = 0;\n    this.serializePassTime = 0;\n  }\n  totalTime: number;\n  globalCodeTime: number;\n  initializeMoreModulesTime: number;\n  deepTraversalTime: number;\n  referenceCountsTime: number;\n  serializePassTime: number;\n}\n\nexport class SerializerStatistics {\n  constructor() {\n    this.objects = 0;\n    this.objectProperties = 0;\n    this.functions = 0;\n    this.functionClones = 0;\n    this.referentialized = 0;\n    this.valueIds = 0;\n    this.valuesInlined = 0;\n    this.delayedValues = 0;\n  }\n  objects: number;\n  objectProperties: number;\n  functions: number;\n  functionClones: number;\n  referentialized: number;\n  valueIds: number;\n  valuesInlined: number;\n  delayedValues: number;\n\n  log() {\n    console.log(`=== serialization statistics`);\n    console.log(`${this.objects} objects with ${this.objectProperties} properties`);\n    console.log(\n      `${this.functions} functions plus ${this.functionClones} clones due to captured variables; ${this\n        .referentialized} captured mutable variables`\n    );\n    console.log(\n      `${this.valueIds} eager and ${this.delayedValues} delayed value ids generated, and ${this\n        .valuesInlined} values inlined`\n    );\n  }\n}\n\nexport type LocationService = {\n  getLocation: Value => void | BabelNodeIdentifier,\n  createLocation: () => BabelNodeIdentifier,\n};\n"]}